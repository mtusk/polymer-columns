<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">

<dom-module id="miller-columns">
  <template>
    <style>
      :host {
        overflow-x: auto;
      }

      #selector {
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        flex-flow:row;
        height: 100%;
      }
    </style>

    <iron-selector
      id="selector"
      on-iron-items-changed="selectorItemsChanged">
      <template
        is="dom-repeat"
        items="{{columns}}"
        as="column"
        index-as="columnIndex">
        <miller-column
          items="{{column.items}}"
          column-id="{{columnIndex}}"
          on-move-left-right="moveLeftRight">
        </miller-column>
      </template>
    </iron-selector>

  </template>

  <script>
    Polymer({
      is: 'miller-columns',

      properties: {
        configuration: Object,
        columns: {
          type: Array,
          notify: true
        }
      },

      ready: function() {
        if (!this.configuration) {
          throw "'configuration' must be on <miller-columns>";
        }

        if (!this.configuration.getColumn) {
          throw "'configuration.getColumn' must be defined";
        }

        var column = this.configuration.getColumn([]);

        this.columns = [column];
      },

      moveLeftRight: function(event, payload, sender) {
        if (payload.direction === 'Left') {
          if (this.$.selector.selected > 0) {
            this.$.selector.selectPrevious();
            this.splice('columns', this.columns.length - 1, 1);
            this.$.selector.selectedItem.focus();
          }
        } else {
          var sourcePathTokens = ['TODO', 'TODO'];
          var column = this.configuration.getColumn(sourcePathTokens);
          this.push('columns', column);
          this.async(function() {
            this.$.selector.selectNext();
            this.$.selector.selectedItem.focus();
          }, 50);
        }
      },

      selectorItemsChanged: function() {
        if (!this.initialFocusSet) {
          this.$.selector.select(0);

          if (!!this.$.selector.selectedItem) {
            this.initialFocusSet = true;
            this.$.selector.selectedItem.focus();
          }
        }
      }
    });
  </script>
</dom-module>
